# 4

## 节点选取

只总结了以往的手法，因为之前已经看过了提案手法了。

### Naive Bayes

子节点对父节点的依赖关系的条件概率$P(x_0|P_a(x_0)) = \frac {P(x_0)P(P_a(x_0)|x_0)} {P(P_a(x_0))}$，其中$P(P_a(x_0)|x_0)=\pi ^M _{i=1} P(x_i|x_0)$

### K2Metric

首先要知道这是一个用来衡量网络复杂度的计算值，用来约束网络训练结果，而不是和股票预测相关的参数。

其次，它的定义相关内容：

- 网络的总节点数为$N$
- 子节点$x_0$能够取的所有状态的总数为$L$
- $x_0$的父节点集合$P_a(x_0)$能够取的所有状态总数为$M$
- 假定父节点集合的状态$Y^j$，子节点集合的状态$X^k$排列组合后所能取的总情况个数是$N_{jk}$

它的定义式子：$K2=\pi ^{M} _{j=1} \frac {(L-1)!} {(N_j+L-1)!} \pi ^L _{k=1} N_{jk}!$，其中$N_j=\sum ^L _{k=1} N{jk}$

### 结点选取的算法

将子节点定义为$x_0$，父节点定义为能够最多取$N$个的$x_i$，构造如下：

1. 首先定义$x_0$的父节点集合$P_a(x_0)$为空集合。
2. 利用$x_0$和$P_a(x_0)$形成的网络计算`K2Metric`值，将此值定义为$S_{best}$
3. 将$i$设置为1
4. 将$x_i$加入到$P_a(x_0)$的集合中
5. 重新用$x_0$与新的$P_a(x_0)$计算`K2Metric`值，并定义为$S$
6. 如果$S$小于等于$S_{best}$，$x_i$就会被从$P_a(x_0)$中删去
7. 如果$S$大于$S_{best}$，将$S$设置为$S_{best}$
8. 将$i$设置为$i+1$，如果$i$小于等于$N$，回到第四步。
9. 将$x_0$与$P_a(x_0)$形成的网络定义为$B$

## 过去手法

### 对回报的离散化

本研究需要用$r_t=(\ln{P_t}-\ln{P_{t-1}} \ctims 100)$ (20)来求得`return`，其中$P_t$是$t$次的股票收盘值，$r_t$是$t$次的股票回报值。

由于贝叶斯网络由包含概率参数节点构成的特性，无法直接处理连续股价回报值。需要使用下述方法将股票回报进行聚类，得到离散值集合用于代表所有可能会出现的股票回报值的集合。（这里的聚类算法决定使用`ward法，5.1小节，省略`）

具体得到离散值结合的算法：

1. 使用(20)求得股票每一天的回报数据
2. 设置横轴是股票回报，纵轴是取得这个回报值的天数进行股票回报频率分布图的绘制
3. 设置聚类的最大类数为$L$，使用聚类算法对频率分布图进行聚类
4. 使用$AIC=\ln{\sigma^2}+\frac {2L} {T}$计算$AIC$，其中的$\sigma=\frac 1 {T-N} \sum ^T _{t=N+1} {(r_t-r`_t)}^2$（方差），$T$是残差的总数（？）。
5. 聚类总数$L$采用当$AIC$最小时对应的$L$
6. 将$L$类聚类时对应的所有股票回报集合设置为${r^1, r^2, ..., r^L}$

### 训练网络给出预测值的依据

本研究用到的贝叶斯网络的结构是$K2 algorithm$，也就是严格按照时间顺序考虑股价回报数据的关系（`Fig. 3.`）

而构建出的$B$给出预测股价回报的依据是$r_t=argmax_{r^l}(P(r^l|B))$ (24)，就是在给定输入的情况下，从聚类得出的所有的回报值中选出正确概率最高的$r_l$作为输出的预测值。

### 以往手法的算法总结

1. 对股价回报进行聚类，得出回报值取值集合${r^1, r^2, ..., r^L}$
2. 根据聚类得出的取值集合作为结点构建贝叶斯网络$B$
3. 使用$B$以及(24)式给出预测的股票回报值。

