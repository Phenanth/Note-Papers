# 研究计划书

> 如果可以的话就是`市场动向变化模型：从宏观得出变动趋势（参考手法），结合大洲或者世界的前日整体趋势综合建立一个BBN或者BRANN对某个市场（或者某一支具体的）股票股价进行预测`。
>
> 先行研究主要提到Kita的第二篇，Others第一篇（BRANN，季节性测试）或者第二篇（BBN，情景分析），第十篇（季节性测试，大洲趋势），第十一篇（根据贝叶斯图拓扑结构分析市场趋势变化）

优化点

- 公式的图片化（`Word`再说）
- 有空的时候把`Kita[4]`写进先行研究里面
- 文献的引用
- 名词的统一（`BRANN`，`BBN`之类的）

## 大纲

- 研究题目
- 研究背景（来自有关SP和BN相关论文的介绍部分）
  - 提出问题点（于先行研究展开讨论）
    - 为什么要研究BN
    - 为什么要研究SP
  - 该问题（SP）的重要性
- 研究目的与研究意义（来自读论文的问题阶段的汇总）
  - 期望的性能提高
  - 对现实世界的应用效果
- **先行研究**
  - 关于BN的多项应用可能性
    - 关于用于金融分析的应用
      - 股票预测
      - 供应链分析
      - 渔业模型的决策
    - 交通流
    - 环境建模
  - 决定就SP作为主要课题，讲述关于SP问题采用的多项应用技术：阐述课题的时候提出`scenario analysis`, `portfolio risk`等金融术语
    - `BN`
    - `BRANN`
    - `Feature xx`
  - 结论：使用`BRANN+SP`作为研究课题
- 研究方法（参考先行研究提出研究方法）
- 参考文献
- 入学后计划（如果需要）

## 研究题目

本人想就**基于市场环境分析的股票指数预测**这一实际应用，在结合前人研究的基础上，继续发展**贝叶斯网络**的研究，对预测准确率以及算法运行时间的优化问题展开研究。

接下来将在研究计划书中展开讨论：对股票指数趋势预测这一课题以及贝叶斯网络相关应用的背景研究、选择此课题的研究目的与意义、过去对此课题进行过的先行研究总结，以及预想中如何使用相应技术的研究方法。

## 研究背景

> 1. 提出问题：预测股票价格
> 2. 预测股票价格的可行性
> 3. 提出新概念：市场环境对股票价格的影响
> 4. 提出技术方法：贝叶斯网络
> 5. 总结研究内容

股票价格预测这一课题从很早开始就得到了投资者与专业分析师的重视，因为股票价格既可以反映一家公司的发展趋势，又能够作为计算市场指数的数据基础，使之反映出市场的兴衰转变。但是这一数字很大程度上会受到多方面因素的影响，股票价格变动的复杂性实际上是包括市场调控政策、企业公关发布的季度收益报告、市场上有名的投资人发布的预测报告以及交易行为冲突等一系列因素决定的，单单靠每日的股票数据想要掌握较为精准的日常或每周的市场动向实际上是比较困难的一件事情。

但股票指数的预测也不是完全无迹可寻的，由于股票的走势必定会收到消费者行为的影响，它的变化存在一定意义上的周期性规律。基于这些周期性变化规律，只要能够为机器学习网络提供一定量的训练数据，它就能够基于数据进行预测网络的构建，并以此为基础对某只股票的收市指数进行预测，这是前人已经证明的结果（Kita[2]，Kita[7]）。

除了股票指数存在周期性变化之外，还有一个不可否认的事实，那就是——市场环境会一定程度上对股票价格的走向产生影响。举例子来说的话，某个大洲区域内国家合作关系的变化势必会改变合作国家市场的兴荣，从而影响到股市的走势；而像是一些世界顶级的生产商所在的市场整体走势也会在一定程度上对全球范围内造成相应的影响。是以，对于股票预测这一课题，需要提出一个能够在准确地认识到世界形势的基础上，对股票价格进行准确判断的数学模型。

<img src=".\pics\image-20191125081240997.png" alt="Figure 1: Closing value of the indices in the best accuracy network (24 h-single index model), for the full dataset period, from Others[10]" style="zoom: 50%;" />

在股票预测这一课题上，贝叶斯网络比起神经网路或是其他机器学习方法，由于是概率神经网络（分类模型）的缘故，在预测股价趋势方面优于标准前馈神经网络（水平估计模型）。这是因为它引入了概率的性质，网络避免了由于参数过多而产生的过拟合的风险，也减少了常规神经网络技术经常遇到的只能找到局部最小解的问题。（Others[1]，Others[2]）不仅如此，由于贝叶斯网络能够在统计意义上充分考虑变量之间的因果关系（Others[9]），在需要可视地了解不同市场之间的影响关系以及影响程度时，贝叶斯网络也被公认为是技术上的不二选择。

<img src=".\pics\image-20191125081936244.png" alt="Figure 2: Naive Bayes Network Structure, from Others[13]" style="zoom: 67%;" />

综上所述，本人决定以贝叶斯网络为训练网络的技术基础，在结合根据其他市场指数训练得到的市场环境分析结果的同时，根据股票的周期性数据作为训练样本，构建一个对预测准确度与计算时间进行优化的股票价格预测模型。

## 研究目的

> 1. 期望成果
>   1. 股票预测算法层面
>       1. 预测准确度（Kita[2]，Others[10]，Others[11]）
>       2. 计算时间优化（Kita[2]第三算法）
>    2. 在Others[10]的基础上做出的对单只股票的指数分析（Others[10]后续工作）
> 2. 现实世界应用
>    1. 作为投资者的有力参考
>    2. 找寻不同市场之间的趋势影响关系（Others[10]优化）

### 期望成果

#### 对算法性能进行优化

本研究想要结合市场环境对股价的影响，使用贝叶斯网络的研究方法，提出能够提高预测准确度的同时降低时间复杂度的股价预测算法。前人已经在研究股票预测以及使用贝叶斯网络进行股票预测这两个课题上分别取得了一定的成果，但同时也存在两方面的不足。接下来首先总结现有算法的不足之处：

一方面是关于预测准确度的，根据Kita[2]所说，其构建手法在以往的时系列分析法的基础上改善了预测精度，但还是不能够预测股价市场的暴涨暴跌等现象；而在Others[10]的研究中，他们的模型在预测准确率上存在缺陷，比起根据神经网络进行构建的市场模型仍然会出现预测准确率无法令人满意的结果；使用了`BRANN`的Others[1]研究中，作者表明自己提出的模型还需要增加技术指标才能获得更好的预测质量。

<img src=".\pics\image-20191125081400821.png" alt="Table 1: image-20191125081400821" style="zoom:67%;" />

另一方面则是和模型构造算法的时间复杂度有关的。在Kita[2]中提出的第三种解决算法得到实施之时，研究者明确表明不采取`Naive Bayes`的贝叶斯网络模型构造会导致计算时间大幅度上升。

<img src=".\pics\image-20191125080927568.png" alt="Table 2: Comparison of three given methods, from Kita[2]" style="zoom:67%;" />

一个优秀的股票预测模型应该同时保持较高的预测准确性，以及拥有反映实时的市场动的能力。由于股票指数预测的即时性与低容错率，以上的两方面问题都会导致对算法的评价大幅下降。本人期待的研究成果算法正是为了能够达到以上的两点条件而提出的。

#### 结合市场对股票股价的预测

就像研究背景中提到的，一支股价的走向势必受到其所在的市场、所在的行业领域的整体走向的影响。在Others[10]所进行的研究中，他们提出了以世界各个市场收市时的大盘指数预测为基础，来预测次日巴西`iBOVESPA`指数的收盘指数这一思路，但他们并没有将环境的分析运用到更为核心的研究内容——单支股票的股价预测之上。基于此点，本人希望能够提出兼顾股票特性与市场特性的预测算法，在放眼市场走向的同时也能够将对趋势的预测结果运用到单个股票的分析上，以提高股票股价预测的准确性。

### 实际应用

提出的算法既可以为投资者提供投资参考，也可以当作一个股市动向变化的风向标，向投资者提出警示。在`Figure 1`中可以看到，发生市场危机期间，各个市场之间的动向是有关联的。而由于所提出的算法是贝叶斯模型，比起其他封闭模型更加简洁，能够直接明了地将市场之间的关联性展示在使用者的面前，这有助于让人们明白市场之间的关联性。所以成果算法既可以作为一个提供决策股票的购买策略的模块使用，也可以直接展现市场之间的依赖性。

<img src=".\pics\image-20191125081240997.png" alt="Figure 1: Closing value of the indices in the best accuracy network (24 h-single index model), for the full dataset period, from Others[10]" style="zoom: 50%;" >

## 先行研究

### Bayesian Method

> 内容综合了Others[2, 6, 3]和Others[4, 5, 9]

贝叶斯网络是一种概率有向无环图模型，它是一种概率有向图模型，能够通过有向无环图表示一组随机变量及变量之间的条件相关性。 对贝叶斯网络进行实际应用的研究(Others[6])中提出，贝叶斯网络允许进行正式的决策分析，并且有助于模型不确定性的合并。在选择策略的时候，尽管模型的参数也很重要但是真正影响最大的应该是模型结构的不确定性。贝叶斯网络方法可以根据数据，提供一个平均表现最好的决策方法。

在`SP`或是商业领域内，`BN`的变量关系探究的能力在长期的研究下已经被证实。其中包括Others[2, 6, 13]。举例而言，Others[2]在评估精益生产[^20]对业务绩效的影响时应用了贝叶斯网络，在`Scenario Analysis`中使用`Naive Bayesian Belief Network`来评估在汽车供应链中使用不同精益工具带来的经济效益。

论文作者希望能够衡量使用不同的能够提高质与量的生产技术后，生产商获得的商业效益。研究的目标有三个，他们希望使用贝叶斯信仰网络做到：

1. 评估联合在一起的对量与对质的精益因子（事先和效益组成一起由行业专家用`Delphi analysis`决定）
2. 解决评估中存在的依存关系问题
3. 确认结合了精益技术后的经济与非经济收益以及变化情况下的持续能力

论文使用贝叶斯信仰网络来就经济效益角度比较了几种精益管理工具的实际效果，研究的问题是一方面缺少除了汽车供应商的其他厂家的数据，另一方面由于厂家通常不会公布精益生产的相关内容，所以研究无法基于精确的精益收益相关的真实数据开展。

[^20]: 精益生产是指企业从他们的组织中学习减少浪费和最昂贵的活动，使其以节省成本的方式执行纯净的生产的过程。

<img src=".\pics\image-20191125103206136.png" alt="image-20191125103206136" style="zoom: 50%;" />

而在此之外，`BN`在变量之间存在已知关联性的应用场景Others[9]与环境建模Others[4 ,5]中也是很好的解决技术。举例而言，在Others[9]中，利用每日数据包括流量、流速、占用率以及车速研究`Intelligent Transportation Systems`。论文中主要讨论了`ITS`研究里面的`Flow Forecasting`，车流预测这一概念。作者将相接的一些路口的历史车流趋势用贝叶斯网络进行建模，其构建的贝叶斯网络中的原因结点（优化后用作预测的数据）以及结果结点（需要预测的数据）之间的联合概率分布是由一个高斯混合模型（`Gaussian Mixture Model, GMM`）所描述的，这个高斯混合模型的参数经过`Competitive Expectation Maximization`算法估计。交通流的预测则是在经过`mmse, minimum mean square error`来演绎。

该方法与许多现有的交通流量预测模型不同，因为它明确包含来自相邻道路链接的信息，且以统计方式分析当前路口的交通状态趋势。由于贝叶斯网络能够在统计意义上充分考虑变量之间的因果关系，所以能够用来对`upstream`和`downstream`路口节点建模与分析。该方法也尝试提出创新，在交通状态参考数据不完整的情况下没有考虑用历史数据填补不完整的部分，而是通过收集`Entire Cause Information`，直接利用贝叶斯网络的消息传递机制，能够在信息不完整的情况下做到预测工作。

<img src=".\pics\image-20191125091717951.png" alt="image-20191125091717951" style="zoom:67%;" />

综上所述，贝叶斯网络在变量关系探究的应用场景内的能力是被世人所认可的，这也是本人决定选择贝叶斯网络作为研究方向的原因之一。

### SP

> 综合了Kita[1, 2]，Others[1, 11, 10]

对于股票价格预测展开的研究中，很多研究都忽略了市场环境这个重要的因素，其中包括Kita[1]，Kita[2]，Others[1]，Others[8]等。而谈到结合市场环境，虽然前人已经分别在股票市场趋势的预测Others[11]以及结合其他股票市场走向的市场综合指数预测Others[10]上展开了一定研究，但结果都差强人意。

接下来的部分将综合讲述现有的对股票预测这一课题所提出的现有机器学习方法的技术总结。

#### Kita 1

使用通过纽约、伦敦和东京三个股票市场指数进行学习过的贝叶斯网络对次日股价动向进行预测（仅仅包含上涨和下跌）。使用的数据来自东京市场的日经平均股价，纽约市场的Dau工业30种平均，以及伦敦市场的FTSE100的数据。学习算法根据股价比起前日是上涨还是下跌进行贝叶斯网络的训练，并以此预测次日的FTSE100的涨跌动向。

使用其他市场的股价指数进行学习的原因之一包括全球性的市场之间是有一定关联性这一因素，作者也阐述根据`sub-prime`问题，其结果的精准度比`technical analysis`的`trend`,`二项model`等方法高出10%，且根据预测去进行股票的购买也获得了较高的收益。

与此同时，文章中指出预测准确率不仅会在影响股价的事件发生时下降，而且会在对某事件发布政策时下降，比如2007年3月日本提出`sub-prime`问题时日本股价下跌，2007年9月美国受到影响且同时影响日本股市，这证明世界市场在某些事件发生时会同时受到一定影响。

#### Kita 2

在第一篇论文的基础上做出改进，使用的数据仍然来自东京市场的`日经平均股价`，纽约市场的`Dau工业`的30种平均值，以及伦敦市场的`FTSE100`的数据。研究者在本篇论文中提出了以下三种手法：

- 基础贝叶斯网络，使用贝叶斯网络分析下一个时点获得特定股价回报的概率，股价收益率是贝叶斯网络的构成结点
- 提升贝叶斯网络，首先贝叶斯网络对已知过去某日股价汇报进行预测，并构建同时包含评判此次预测的预测误差数以及股价回报的贝叶斯网络（计算量上升，主要是计算回报比较花时间）
- 第三种贝叶斯网络，不假设`Naive Bayes`，计算时间上升了很多

成果在以往的时系列分析法的基础上改善了预测精度，但还是不能够预测股价市场的暴涨暴跌等现象。

对于后续的研究，作者希望今后增加预测用数据的种类，根据市场趋势的转点自动地能够进行预测手法的转换，说不定能够预测暴涨暴跌现象。

- 股价回报的离散化方法这一部分里，为了模拟股价的回报，本研究采用的`等分割clustering`以及`watt方法`如果将数值太过详细地分散了的话，贝叶斯网络的预测精度又会下降。可能需要使用其他的`clustring`方法（K-Means，C-Means）等
- 贝叶斯网络的训练需要用到较为大量的数据，希望能够组合使用过往的时序列分析手法来让用于预测的数据量下降。
- 预测精度最好的方法的计算量过大，需要能够缩小计算时间的方法。

#### Others 1

该研究中，作者对每日股市价格以及财经指数优化，作为用于预测未来收市股票价格的输入数据（原本是作为时序列数据进行分析）。文章表示预测这些趋势的复杂性在于每日股票价格走势中固有的噪声和波动性。

其使用的贝叶斯正则化神经网络为网络权重分配了概率性质，允许网络以最佳方式自动地约束网络的复杂性（对过于复杂的网络进行惩罚）。`BR`在此次研究中则是用来规避神经网络的过拟合问题。模型使用了结合`Bayesian Regularization`的`Levenberg-Marquardt`算法来预测股票价格。结果上减少了常规神经网络技术经常遇到的过拟合以及只能找到局部最小解的问题。由于引入了概率性质，网络避免了由于过量引入参数而提升的过拟合的风险。比起另一个混合神经网络模型，以及`fusion model & AR-IMA model`也有潜在优势。

<img src=".\pics\image-20191125090636764.png" alt="image-20191125090636764" style="zoom:67%;" />

在检验上，用了`Microsoft`和`Goldman Sachs Group`两支股票来展示模型的准确性，在拥有较好的准确性的同时还不需要对数据的预处理，季节性测试或者是周期性分析。而在文章总结部分，作者则表示将来有需要增加或替代其他技术指标以在应用中提高模型预测质量的可能性。

值得提到的是，该研究中提出的`Bayesian Regularized Artificial Neural Network`与贝叶斯网络对比，同样是概率图模型，但这种网络由于是与神经网络所组成的混合网络，存在自动处理网络概率权重的优势，在对参数的划分上不需要人为地制定，本人认为这也不失为一种将来研究中可以参考的技术方法。

#### Others 11

研究内容的本质是在感兴趣的时间段内，为一组选定的宏观经济因素计算相应的动态贝叶斯因素图（`Dynamic Bayesian Factor Graph`）。根据图进行的时序计算能够同时给出一段特定时间内，这些宏观经济因素相互影响关系以及影响程度评估指数。

关于选择贝叶斯网络的原因，作者指出人们需要引起关注的是，非线性并不是底层证券市场系统的唯一复杂因素。众所周知，该证券市场系统会随着时间变化而没有明确的系统边界。如果仅仅依赖神经网络，`SVR(Artificial Neural Regression)`，随机森林以及`Genetic Algorithms`捕捉的只是非线性的函数而非其本质。无论是多么精妙的模型，始终都会受到选择参数不当的问题。由此，作者认为需要抛弃构建不变的模型的理念，使用从线上直接收集到的数据流作为预测方法的数据来源进行预测。贝叶斯网络能够显示清晰的变量关系的特点正好符合了设计理念。

而研究的要点有两个：首先是做到能够预测股票走向的趋势，其次是构建主要的参数以及内部关系会根据学习随时变化的网络来用作预测。任何时候相邻图表中的任何拓扑结构变化都将在短期内预测市场趋势的变化。

作者的计算分析还表明，如果基本动态贝叶斯因子图的拓扑结构不变，则总体市场趋势将保持不变。通过将其应用于对美国和中国股市趋势的分析，证明了该方法的有效性，并具有良好的预测结果。在作者对中国深圳过去十一年周期内的图结构变化进行观察时，发现连续几个月内图结构可能都不一定会变化，而变化时通常是过去关系的消失或箭头指向变化，或者在两种因子之间会有新的消息的出现等。

<img src=".\pics\image-20191125165650600.png" alt="image-20191125165650600" style="zoom:67%;" />

#### Others 10（重点）

本研究关注点是使用贝叶斯网络，找出世界上的哪一个股票市场指数对巴西股票市场指数的影响最大。过程是将指数走向输入到能够反映各个大陆市场相关依赖关系的网络，追踪24或者48小时的周期，再输出预测的次日巴西市场收盘指数`iBOVESPA`。此次研究目的之一是找到对`iBOVESPA`指数影响最大的市场以及其指数，之二是找到最适合开始分析的时间窗口。

算法的启发思想方面，作者提出：对于世界上每一个随着日升日落逐一开始与结束的市场，上一个关闭市场的信息会影响下一个。还讲述了该系统能够应用到经济学上，讨论什么指数会对一个市场产生较大的影响。由此得出的模型比起其他封闭模型更加简单，由于即使遇到错误数据集也不做任何假设，模型对于任何数据的泛化能力也很好。但是，比起一些神经网络以及`SVM`模型，所提出的模型在预测准确率上还是存在不足。

<img src=".\pics\image-20191125105125033.png" alt="image-20191125105125033" style="zoom:67%;" />

成果方面，模型不仅会对次日收盘指数进行预测，该模型的另一种可能用途是直接确定哪些市场对`iBOVESPA`的影响最大，即在危机期间减少可能的市场污染来源，那么在危机发生时就能够反映出哪个市场最容易对目标市场传递危机的影响效果。除此之外，比起现存的方法，此方法更加简单而且对用户而言可追踪。因为能清晰地看到市场间的依赖关系，它也能被应用至`Decision Support System`中，帮助使用者更有自信地做出决策。举个例子，当合约达成后，可以看出合约前后什么市场指数影响关系的变化，看出什么公司从中获益，以及市场参与者是怎样的看法，将来类似合约是否可能有同样的反应等。

<img src=".\pics\image-20191125105233588.png" alt="image-20191125105233588" style="zoom:67%;" />

劣势方面，贝叶斯网络的固定拓扑结构使得它对结构的变化并没有那么好的适应性，比如在48h时间窗口的情况下需要考虑大洲内的依赖关系时，会打破之前的大洲内市场是独立的这一假设。一种解决方法可以是自动进行网络的架构的学习。但是，这很少会导致朴素的贝叶斯结构（提到Kita的研究），在给定输出节点的值的情况下，所有节点都被视为独立的。此外，本次研究使用的是经济危机期间的数据，而经济学家指出在危机期间的世界市场和会呈现一致的趋势，且这样的趋势也只会存在于危机期间。

作者表示日后的研究将会放眼在使用非市场危机时刻的数据进行训练这一点上。由于本次研究中的部分数据是来自于`sub-prime crisis`，可能造成丢失一部分市场没有发生危机的时候的网络拓扑信息。对于对比多市场的基本思想，日后也会尝试使用`Deep Neural Networks`，或者是选择根据不同的拓扑情况来构建网络，比如不考虑大洲情况而是只考虑某个指数对其的影响，或是根据`capitalization`或者`price-weighted`将指数分成不同类型的数据进行考虑。

而本人认为，网络中的每一个结点的概率是根据给定在其父节点中观察到的趋势值来估计的，且为了避免给没出现过的父节点组合值赋值$null$，作者还为等式加上了`laplace smoothing term`，也就是在计算用于估计P的频率时，将1加到分子上，将2加到分母上来避免计算上导致0/0的问题。这些处理细节存在以下**不妥之处**：

- 指数趋势情况排列组合后会对应的情况过多，而数据集中只存在1600天的数据，可能会导致遭到多种情况稀释后的单个情况下的训练样本过少，从而使网络预测结果失去可靠性。
- 同理，在`laplace smoothing`时，计算上给分子分母分别加上1和2对计算结果的准确性也可能造成影响。

### 总结

> - 贝叶斯网络优势
>   - 基于不完整数据的综合能力：前面Others[2]提出自己的精益数据不完整，Others[9]提出交通传感器的数据有时也是不完整
>   - 变量关系可视化（Others[9, 11]）
>   - 能够反映`sub-prime crisis`对世界范围的影响，Kita[1]和Others[10]都提到了
> - 现有问题点
>   - 准确率不高（Kita[1, 2], Others[10]）
>   - 没有综合市场环境（Kita[1, 2], Others[1, 11]）

经过先行研究，关于贝叶斯网络在股票预测课题上的优势，可以总结如下：

- 基于不完整数据的预测能力：Others[2]是精益数据不完整的情况下进行的研究，而Others[9]的作者提出由于传感器性能制约，训练数据也是偶尔出现不完整项目。但贝叶斯网络不需要靠数据假设就能够很好地对应这些不完整的数据。
- 变量关系清晰明了：在Others[9]中，使用贝叶斯网络对路口关系进行图的构建就是因为能够显在地反映代表交通路口的结点间的依赖关系，由此能够了解道路流量的变化主要是因为什么路口的车流量变大导致的。Others[11]中则是直接地应用了这一点，以此来判断股市趋势走向的变化。
- 能够反映世界范围内出现的事件对股价的影响，这一点在Kita[1]与Others[10]中都提到了，本人认为能够自动地将世界范围内发生的重大事件对股市的影响反映到预测结果上这一点，是做到对市场环境综合分析的重要基础。

而目前的研究内容所存在的问题，也能够总结如下：

- 没有综合市场环境进行预测：不仅是Kita[1,2]，或者是Others[1, 11]，现存的大部分预测算法都没有将市场环境纳入建模，这就会使模型缺少了很重要的参考风向——来自其他市场的指标。

- 模型的准确率仍然不理想：虽然Others[10]提出了需要关注其他市场对研究市场的影响，但他们采用的本来是想要提高模型泛化性的`cross-validation`测验模型方法破坏了模型之内的递归关系，反而使其不适合大多数的时序分析。

本人将会在接下来的学习期间针对以上问题点，提出有效的解决方案。接下来一小节就是关于研究方法的详细内容。

## 研究方法

> 结合市场预测模型的结果和股票数据构建贝叶斯网络，参考Kita[2]
>
> 这边所有的和研究方法有关的图都需要改一下，改成和日本有关的。（等之后调整）

为了综合考虑世界环境的市场走向对目标市场指数趋势的影响，将参考Others[10]中提出的概率统计方法，从网络收集世界上的12个股票市场的大盘数据。（`训练数据的收集与预处理`）

基于以上收集的数据，预训练一个能够分析对日本大盘指数产生何种影响的贝叶斯网络模型$P(h_i|d)$。在得到分析市场环境的模型$P(h_i|d)$后，首先使用该模型对市场环境进行分析，找到世界上对日本市场影响最大的市场指数的组合$S$，以及预数据来源的最佳时间窗口长短$h$。（`市场环境模型构建与市场分析`）

而为了进行结合市场分析的具体股票的股价预测，在根据历史数据得到$S$和$h$的前提下，根据Kita[4]中所用到的预测手法，收集对应的预测数据进行贝叶斯网络的训练，并用`股票名`进行训练成果网络性能的评估。（`贝叶斯网络股价预测模型的改进`）

### 训练数据的收集与预处理

从[Yahoo! Finance](https://finance.yahoo.com/)分别收集12个市场的过去数据，可以参考其交易周期与日本市场的时间重合关系。其中的12个市场分别是：

- `Nasdaq Composite`USA
- `NYSE Composite`，USA
- `Dow Jones`，USA
- `Merval`，Argentina
- `Nikkei 225`，Japan
- `Shanghai Composite`，China
- `Hang Seng`，China
- `BSE 30 Sensex`，India
- `FTSE 100`，UK
- `Stockholm General`，Sweden
- `Dax`，Germany
- `Cac 40`，France

（插入`Table 1`）

在收集到交易数据后，去除周末的交易数据。需要注意的是原方法里作者提出去除由于假期导致部分市场休市日期内的其他市场交易数据可能导致实验后期反而引入更多人工数据，这里对由于假期秀导致休市的市场数据的处理将会是人工地设置一个收市指数。

实际进行训练时，将使用`5-fold cross validation`进行数据的训练和评估。在模型内部，对数据将随机地分成平均的五份（`subsets, also called folds`）。在每次`validation/testing`时会有一份被随机的抽出作为验证数据，而剩下的四份作为训练数据使用。以上的步骤将被重复五次，每次都使用不同的测试集和训练集来减少结果的不确定性。用于评估模型的准确率是指正确分类的数量除以测试集中样本的数量。总体的准确率将以五次训练的平均准确率为准。

为了更好地评估模型，结合Others[10]的结论部分，将会使用24h作为数据来源的窗口，也就是当天日本收市时间往前推24h内收市的市场指数将会作为对日本市场影响的分析数据来源。Others[10]中也同时指出，将12个市场按照大洲（实际是时区）分组，每次从一组内选取一个市场作为数据来源时得到的预测准确性最高，在此次实验中也将这样执行。

于是能够知道，一个24h每大洲1指数的训练实例由以下组成：

- 第$t$天的`Japan`的收市指数趋势
- 第$t-1$天的`American index`
- 第$t-1$天的`European index`
- 第$t-1$天的`Asian index`

训练实例根据每日数据构建，再被输入到学习网络中。接下来的小节内将会讨论数学模型的构建方法。

### 市场环境模型构建与市场分析

在上一小节内已经决定了市场环境分析模型的一个训练实例的内容，并将单次训练中用到的所有训练样本合集设为$d_i$，那么根据每个大洲选取一个指数为原则，贝叶斯网络的结构如下图。（插入Others[10]的`Fig. 1.`）

在这种情况下，同一大陆内的指数趋势被认为是彼此独立的，而大洲之间（指不同时区的市场集合）的依存关系则保持不变。也就是说欧洲和亚洲之间的关系现在对应的是，所选取的所有在欧洲大陆内的指数与所有在亚洲大陆内的指数之间的依赖关系。另外，即使`Fig. 1.`中，$SP_{00}$位于亚洲大陆，但仅在预测时它才独立于其他亚洲市场（即$Asia_{00}$）。但是，在过去24小时内（即Asia_{24}）查看这些同为亚洲大陆内的市场时，就会认为存在依赖关系，这样做是为了使预测目标市场算法保持简便形态。

根据贝叶斯理论，该网络的数学模型是$P(h_i|d)=\frac {P(d|h_i)P(h|i)} {P(d)}$ (1)，指的是在给定数据集$d$的情况下$h_i$发生的概率。由于`Nikkei`相较于昨天的收盘指数可能会存在${high, low}$两种趋势，所以会存在两种事件${h1, h2}$，综合表示为{h_i}。

而根据`Fig. 1.`提出的贝叶斯网络的结点间条件依赖的条件对数学模型进行变形得到：$P(h_i|d) = P(h_i | `Nikkei`'s parents)$ (2)，而等式后面的部分实际上可以用每个`Nikkei`的父节点的取值的组合所对应的$h_i$取真的概率来估计得到。

使用不同的世界市场指数作为(2)式总结的数学模型的输入就能够统计学习到对日本市场大盘指数影响最大的世界市场指数类型，并用于在下一小节中构建考虑市场影响的股价预测模型。

### 贝叶斯网络股价预测模型的改进

> 如果有时间，把Kita[4]的其他部分都看完，然后在上面的论文列表里加上Kita[4]的不足总结

先行研究中已经阐述Kita[1, 2]的相关内容，而由于研究者在Kita[4]中对自己提出的模型进行了改进，这里进行贝叶斯网络构建使用的手法也主要参考其中提到的优化后模型的手法（下面插入Kita[4]的`Fig. 1.`）。

首先，需要先介绍一下原先提出的贝叶斯网络模型。其构建原理是将子节点定义为$x_0$，父节点定义为能够最多取$N$个的$x_i$，子节点对父节点的依赖关系的条件概率$P(x_0|P_a(x_0)) = \frac {P(x_0)P(P_a(x_0)|x_0)} {P(P_a(x_0))}$，其中的$P(P_a(x_0)|x_0)=\pi ^M _{i=1} P(x_i|x_0)$。后续构造步骤如下：

1. 首先定义$x_0$的父节点集合$P_a(x_0)$为空集合。
2. 利用$x_0$和$P_a(x_0)$形成的网络计算`K2Metric`值$K2=\pi ^{M} _{j=1} \frac {(L-1)!} {(N_j+L-1)!} \pi ^L _{k=1} N_{jk}!$，其中$N_j=\sum ^L _{k=1} N{jk}$，并将此值定义为$S_{best}$
3. 将$i$设置为1
4. 将$x_i$加入到$P_a(x_0)$的集合中
5. 重新用$x_0$与新的$P_a(x_0)$计算`K2Metric`值，并定义为$S$
6. 如果$S$小于等于$S_{best}$，$x_i$就会被从$P_a(x_0)$中删去
7. 如果$S$大于$S_{best}$，将$S$设置为$S_{best}$
8. 将$i$设置为$i+1$，如果$i$小于等于$N$，回到第四步。
9. 将$x_0$与$P_a(x_0)$形成的网络定义为$B$

其次，在Kita[4]中，对算法的优化主要体现在对回报值进行了聚类处理并将结果用于贝叶斯网络的构建，总结如下：

1. 对需要预测的股票的每日收市数据计算股价回报$r_t=(\ln{P_t}-\ln{P_{t-1}} \ctims 100)$，并对所有股价回报进行聚类，得出回报值取值集合${r^1, r^2, ..., r^L}$
2. 根据聚类得出的取值集合作为结点，按照上述的网络构建算法构建贝叶斯网络$B$
3. 使用$B$以及预测原则$r_t=argmax_{r^l}(P(r^l|B))$给出预测的股票回报值$r_t$。

最后，经过综合了市场环境趋势分析信息，改进后的贝叶斯网络还会同时根据聚类结果的回报值当日的市场数据分析得出市场的趋势预测值，与回报值同时作为结点构成贝叶斯网络。其构建算法步骤如下：

1. 使用过去构造的网络$B$（原文`4小节`）进行预测，得到预测值
2. 定义误差值为预测值与真实值的差值
3. 使用`Ward`方法（原文`5.2小节`）对误差值求取误差分布的离散值
4. **将聚类得到的回报值取值集合以及与其对应的环境分析模型预测的趋势值作为结点构造贝叶斯网络$B'$**
5. 使用$B'$进行股价回报的预测并得到值作为预测结果。

其中，为了与原模型进行对照，在模型的验证阶段将会选择`Toyota汽车`等其他真实股票的数据作为训练数据进行模型的性能评估。

## 研究计划

有必要的话，会在研究期间使用数据不断分析对日本市场影响最大的指数子集来自什么市场，并调整后续的预测过程中使用的指数的市场来源。研究期间，本人也构思了几个对提出手法的优化可能有所帮助的提案：

- 市场分析模型方面
  - 由于市场分析模型使用的固定拓扑结构使得它对结构的变化并没有那么好的适应性，可以考虑将建模手法换成自动学习网络拓扑结构的学习方法，比如`Bayesian Regularized Artifical Neural Network`等。
  - 由于不同市场之间的影响作用随着时间被拉长实际存在变弱的趋势，可以考虑将时间窗口缩小为12h，实际则是对应将市场影响的考虑范围缩小。
- 贝叶斯预测网络方面
  - 在对股价回报分布求取离散值的方法选取方面，比起`ward`法，可以考虑使用`K-means`，`Hierarchical clsutering`等聚类方法。

如果研究顺利的话，本人还希望在留学期间进行以下学习/研究内容：

- 根据网上的实时数据进行股票预测模型的调整并给出预测结果

## 参考文献

> 目前提到了的论文

Kita[1, 2, 4]

Others[1, 2, 3, 6 8, 9, 10, 11, 13]